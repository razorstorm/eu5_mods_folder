OGAS_Auto_Road_Initialize = {
	every_country = {
		every_owned_location = {
			remove_variable = OGAS_Cache_Auto_Road_Complete
			remove_variable = OGAS_Cache_Auto_Road_Ongoing
		}
	}
	#use OGAS_Cache_Auto_Road_Complete to mark those location which OGAS think already has best proximity, use OGAS_Cache_Auto_Road_Ongoing to mark the next round location to construct new road
	every_owned_location = {
		remove_variable = OGAS_Cache_Auto_Road_Complete
		remove_variable = OGAS_Cache_Auto_Road_Ongoing
	}
	random_owned_location = {
		limit = {
			is_capital = yes
		}
		set_variable = OGAS_Cache_Auto_Road_Complete
	}

	refresh_map_colors = yes

	set_variable = {
		name = OGAS_Auto_Road_Construct
		value = 0
	}
}

OGAS_Auto_Road_Ongoing_Check_Complete = {
	#when road completed, check this location has best proximity or not, if yes mark complete
	every_owned_location = {
		limit = {
			has_variable = OGAS_Cache_Auto_Road_Ongoing
			not = {
				any_neighbor_location = {
					is_ownable = yes
					owner ?= root
					proximity_prediction > prev.proximity
				}
			}
		}
		set_variable = OGAS_Cache_Auto_Road_Complete
		remove_variable = OGAS_Cache_Auto_Road_Ongoing
	}
}
OGAS_Auto_Road_Ongoing_Next_Round = {
	every_owned_location = {
		limit = {
			has_variable = OGAS_Cache_Auto_Road_Complete
		}
		every_neighbor_location = {
			limit = {
				is_ownable = yes
				owner ?= root
				not = {
					has_variable = OGAS_Cache_Auto_Road_Complete
					has_variable = OGAS_Cache_Auto_Road_Ongoing
				}
			}
			if = {
				limit = {
					any_neighbor_location = {
						is_ownable = yes
						owner ?= root
						proximity_prediction > prev.proximity
					}
				}
				#if exist any loaction proximity_prediction higher than this, save scope
				ordered_neighbor_location ={
					limit = {
						is_ownable = yes
						owner ?= root
						proximity_prediction > prev.proximity
					}
					order_by = proximity_prediction
					save_scope_as = highest_proximity_prediction_location
				}
				#every ongoing location must mark a real proximity_prediction, use this mark to calculate new road to another location rather than current proximity
				set_variable = { 
					name = OGAS_Cache_Auto_Road_Ongoing
					value = scope:highest_proximity_prediction_location.proximity_prediction
				}
				set_variable = { 
					name = highest_proximity_prediction_location
					value = scope:highest_proximity_prediction_location
				}
			}
			else = {
				#if not exist any loaction proximity_prediction higher than this, mark as complete
				set_variable = OGAS_Cache_Auto_Road_Complete
				remove_variable = OGAS_Cache_Auto_Road_Ongoing
				remove_variable = highest_proximity_prediction_location
			}
		}
	}
}
OGAS_Auto_Construct_Road = {
	if = {
		limit = {
			root.var:OGAS_Auto_Road_Construct = 1
		}
		while = {
			limit = {
				root.gold > OGAS_deposit_gold
				any_owned_location = {
					has_variable = OGAS_Cache_Auto_Road_Ongoing
					has_road_constructions = no
				}
			}
			count = 10
			random_owned_location = {
				limit = {
					has_variable = OGAS_Cache_Auto_Road_Ongoing
				}
				save_scope_as = OGAS_Auto_Construct_Road_Scope_From
				if = {
					limit = {
						has_variable = highest_proximity_prediction_location
					}
					var:highest_proximity_prediction_location = {
						save_scope_as = OGAS_Auto_Construct_Road_Scope_To
					}
				}
				else ={
					ordered_neighbor_location = {
						limit = {
							is_ownable = yes
							owner ?= root
							proximity_prediction > prev.proximity
						}
						order_by = proximity_prediction
						save_scope_as = OGAS_Auto_Construct_Road_Scope_To
					}
				}
				if = {
					limit = {
						owner = {
							has_advance = railroad_advance
						}
					}
					owner = {
						construct_road = {  
							road_type = road_type:railroad
							from = scope:OGAS_Auto_Construct_Road_Scope_From
							to = scope:OGAS_Auto_Construct_Road_Scope_To
						}
					}
				}
				else_if = {
					limit = {
						owner = {
							has_advance = modern_road_advance
						}
					}
					owner = {
						construct_road = {  
							road_type = road_type:modern_road
							from = scope:OGAS_Auto_Construct_Road_Scope_From
							to = scope:OGAS_Auto_Construct_Road_Scope_To
						}
					}
				}
				else_if = {
					limit = {
						owner = {
							has_advance = paved_road_advance
						}
					}
					owner = {
						construct_road = {  
							road_type = road_type:paved_road
							from = scope:OGAS_Auto_Construct_Road_Scope_From
							to = scope:OGAS_Auto_Construct_Road_Scope_To
						}
					}
				}
				else_if = {
					limit = {
						owner = {
							has_advance = road_building
						}
					}
					owner = {
						construct_road = {  
							road_type = road_type:gravel_road
							from = scope:OGAS_Auto_Construct_Road_Scope_From
							to = scope:OGAS_Auto_Construct_Road_Scope_To
						}
					}
				}
			}
		}
	}
}